{"version":3,"file":"src_app_pages_tabs_home_top-up_top-up_module_ts.js","mappings":"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","sources":["./src/app/pages/tabs/home/top-up/top-up.page.html","./src/app/pages/tabs/home/top-up/top-up-routing.module.ts","./src/app/pages/tabs/home/top-up/top-up.module.ts","./src/app/pages/tabs/home/top-up/top-up.page.ts"],"sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button></ion-menu-button>\\n    </ion-buttons>\\n    <ion-title>\\n      Top Up\\n    </ion-title>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-icon (click)=\\\"back()\\\" color=\\\"primary\\\" slot=\\\"icon-only\\\" name=\\\"chevron-back-outline\\\"></ion-icon>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content class=\\\"ion-align-items-center\\\" [style.--background]=\\\"scanActive ? 'transparent' : '#ffffff'\\\">\\n  <form [formGroup]=\\\"form\\\" class=\\\"ion-margin\\\">\\n    <ion-item lines=\\\"full\\\" color=\\\"light\\\">\\n      <ion-input formControlName=\\\"amount\\\" [type]=\\\"type ? 'text' : 'text'\\\" placeholder=\\\"Enter amount\\\"></ion-input>\\n    </ion-item>\\n    <ion-text\\n      color=\\\"danger\\\"\\n      *ngIf=\\\"!form.get('amount').valid && form.get('amount').touched\\\">\\n      <ion-text\\n        class=\\\"error\\\"\\n        *ngIf=\\\"form.get('amount').hasError('required')\\\">\\n        * Please enter the amount\\n      </ion-text>\\n      <ion-text\\n        class=\\\"error\\\"\\n        *ngIf=\\\"!form.get('amount').hasError('required') && form.get('amount').hasError('pattern')\\\">\\n        * Please enter a proper amount\\n      </ion-text>\\n    </ion-text>\\n\\n  </form>\\n  <div class=\\\"ion-margin-horizontal\\\">\\n  <ion-button\\n    *ngIf=\\\"!isLoading\\\"\\n    size=\\\"large\\\"\\n    expand=\\\"block\\\"\\n    shape=\\\"round\\\"\\n    color=\\\"primary\\\" (click)=\\\"submitRequest()\\\">\\n    Confirm\\n  </ion-button>\\n    <ion-button\\n      *ngIf=\\\"isLoading\\\"\\n      size=\\\"large\\\"\\n      expand=\\\"block\\\"\\n      shape=\\\"round\\\"\\n      color=\\\"primary\\\">\\n      <ion-spinner></ion-spinner>\\n    </ion-button>\\n  </div>\\n\\n</ion-content>\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { TopUpPage } from './top-up.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: TopUpPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class TopUpPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport {FormsModule, ReactiveFormsModule} from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { TopUpPageRoutingModule } from './top-up-routing.module';\n\nimport { TopUpPage } from './top-up.page';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        FormsModule,\n        IonicModule,\n        TopUpPageRoutingModule,\n        ReactiveFormsModule\n    ],\n  declarations: [TopUpPage]\n})\nexport class TopUpPageModule {}\n","import {AfterViewInit, Component, OnDestroy, OnInit} from '@angular/core';\nimport {Router} from '@angular/router';\nimport {\n  AlertController,\n  LoadingController,\n  MenuController,\n  ModalController,\n  Platform,\n  ToastController\n} from '@ionic/angular';\nimport {AuthService} from 'src/app/services/auth/auth.service';\nimport {doc, Firestore, getDoc} from '@angular/fire/firestore';\nimport {FormControl, FormGroup, Validators} from '@angular/forms';\nimport {IrohaService} from '../../../../services/iroha.service';\nimport {BarcodeScanner, SupportedFormat} from '@capacitor-community/barcode-scanner';\nimport {AngularFirestore} from \"@angular/fire/compat/firestore\";\n\n@Component({\n  selector: 'app-top-up',\n  templateUrl: './top-up.page.html',\n  styleUrls: ['./top-up.page.scss'],\n})\n\nexport class TopUpPage implements OnInit, AfterViewInit, OnDestroy {\n\n  form: FormGroup;\n  type = false;\n  isLoading = false;\n  private loading;\n  private uid = this.ionicAuthService.getUid();\n  private id: any;\n  private scanActive= false;\n  private result: string;\n  private prk: any;\n  private amount: any;\n\n  constructor(\n              private modalCtrl: ModalController,\n              private toastCtrl: ToastController,\n              private router: Router,\n              private _firestore: Firestore,\n              private ionicAuthService: AuthService,\n              private iroha: IrohaService,\n              private alertController: AlertController,\n              private loadingController: LoadingController,\n              private platform: Platform,\n              private afs: AngularFirestore,\n              private menu: MenuController)\n  {\n    this.initForm();\n    this.menu.enable(false);\n  }\n\n  ngOnInit() {\n  }\n  ngAfterViewInit(){\n  }\n  async ionViewDidEnter() {\n    await this.platform.ready().then(() => {\n      document.body.classList.toggle('dark', false);\n    });\n  }\n\n  async ionViewDidLeave() {\n    await this.menu.enable(true);\n  }\n\n  ngOnDestroy(){\n    this.stopScanner();\n  }\n\n  async startScanner() {\n    const allowed = await this.checkPermissions();\n    if (allowed) {\n      this.scanActive = true;\n      const result = await BarcodeScanner.startScan({ targetedFormats: [SupportedFormat.QR_CODE] });\n      if (result.hasContent) {\n        this.result = result.content;\n        this.scanActive = false;\n        await this.topUp();\n      }\n    }\n  }\n\n  async checkPermissions() {\n    return new Promise(async (resolve, reject) => {\n      const status = await BarcodeScanner.checkPermission({force: true});\n      if (status.granted) {\n        resolve(true);\n      }\n      else if(status.denied) {\n        const alert = await this.alertController.create({\n          header: 'No permissions',\n          message: 'Please enable camera in your settings.',\n          buttons: [{\n            text: 'No',\n            role: 'cancel'\n          },\n            {\n              text: 'Open Settings',\n              handler: () => {\n                resolve(false);\n                BarcodeScanner.openAppSettings();\n              }\n            }]\n        });\n      }\n      else {\n        resolve(false);\n      }\n    });\n  }\n\n  stopScanner() {\n    BarcodeScanner.stopScan();\n    this.scanActive = false;\n  }\n  initForm() {\n    this.form = new FormGroup({\n      amount: new FormControl(null, {validators: [Validators.required, Validators.pattern('^[0-9]*$')]}),\n   });\n  }\n\n  async submitRequest() {\n    if (!this.form.valid) {\n      this.form.markAllAsTouched();\n      return;\n    }\n    await BarcodeScanner.prepare();\n    await this.startScanner();\n  }\n\n  async topUp(){\n    this.loadingController.create({\n      message: 'Collecting coins...',\n    }).then(async overlay => {\n      this.loading = overlay;\n      this.loading.present();\n      console.log(this.form.value);\n      await this.transferMoney();\n      this.iroha.wallet.name = '';\n      await this.iroha.setName(this.id);\n      this.iroha.wallet.balance = 0;\n      await this.iroha.setBalance(this.id);\n    });\n  }\n\n  back() {\n    this.router.navigateByUrl('/tabs', {replaceUrl: true});\n  }\n\n  async getFirebaseData(key) {\n    const dataRef = doc(this._firestore, `keys/${(key)}`);\n    const dataSnap = await getDoc(dataRef);\n    this.prk = dataSnap.data().prk;\n    this.amount = dataSnap.data().amount;\n    console.log(this.prk, this.amount);\n    await this.afs.collection(`keys`).doc(key).delete();\n  }\n\n  async transferMoney() {\n    // eslint-disable-next-line no-underscore-dangle\n    const docRef = doc(this._firestore, 'users', this.uid);\n    const docSnap = await getDoc(docRef);\n    if (docSnap.exists()) {\n      console.log(docSnap.data().username.concat('@test'));\n      this.id = docSnap.data().username.concat('@test');\n      // eslint-disable-next-line max-len\n      await this.iroha.addSignatory(this.result);\n      await this.getFirebaseData(this.result);\n      if (this.amount !== this.form.value.amount) {\n        this.loading.dismiss();\n        await this.showAlert('You entered the wrong amount!', 'Top Up Failed');\n      }\n      else {\n        await this.iroha.topUp(this.id, '', this.form.value.amount, this.prk).then(async d => {\n            await this.iroha.removeSignatory(this.result);\n            this.loading.dismiss();\n            await this.showAlert('RM' + this.form.value.amount + ' has been added to your balance.', 'Top Up Success');\n          }\n        ).catch(e => {\n          this.loading.dismiss();\n          this.showAlert(e, 'Top Up Failed');\n        });\n      }\n    }\n    else {\n      this.loading.dismiss();\n      console.log('Error! No such account.');\n    }\n  }\n\n  async showAlert(message, header) {\n    const alert = await this.alertController.create({\n      header,\n      message,\n      buttons: ['OK'],\n    });\n\n    await alert.present();\n  }\n\n\n\n}\n"],"names":[],"sourceRoot":"webpack:///"}