{"version":3,"file":"src_app_pages_tabs_search_user-details_user-details_module_ts.js","mappings":"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","sources":["./src/app/pages/tabs/search/user-details/user-details.page.html","./src/app/pages/tabs/search/user-details/user-details-routing.module.ts","./src/app/pages/tabs/search/user-details/user-details.module.ts","./src/app/pages/tabs/search/user-details/user-details.page.ts"],"sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-title>Set Amount</ion-title>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-icon (click)=\\\"back()\\\" color=\\\"primary\\\" slot=\\\"icon-only\\\" name=\\\"chevron-back-outline\\\"></ion-icon>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<form [formGroup]=\\\"form\\\" class=\\\"ion-margin\\\">\\n  <div class=\\\"ion-margin-vertical\\\">\\n    <ion-item lines=\\\"full\\\" color=\\\"light\\\">\\n      <ion-input formControlName=\\\"amount\\\" [type]=\\\"type ? 'text' : 'text'\\\" placeholder=\\\"Enter amount\\\"></ion-input>\\n    </ion-item>\\n    <ion-text\\n      color=\\\"danger\\\"\\n      *ngIf=\\\"!form.get('amount').valid && form.get('amount').touched\\\">\\n      <ion-text\\n        class=\\\"error\\\"\\n        *ngIf=\\\"form.get('amount').hasError('required')\\\">\\n        * Please enter the amount\\n      </ion-text>\\n      <ion-text\\n        class=\\\"error\\\"\\n        *ngIf=\\\"form.get('amount').hasError('pattern')\\\">\\n        * Please enter a proper amount\\n      </ion-text>\\n    </ion-text>\\n  </div>\\n  <div class=\\\"ion-margin-vertical\\\">\\n    <ion-item lines=\\\"full\\\" color=\\\"light\\\">\\n      <ion-input formControlName=\\\"reference\\\" [type]=\\\"type ? 'text' : 'text'\\\" placeholder=\\\"Enter reference\\\"></ion-input>\\n    </ion-item>\\n    <ion-text\\n      color=\\\"danger\\\"\\n      *ngIf=\\\"!form.get('reference').valid && form.get('reference').touched\\\">\\n      <ion-text\\n        class=\\\"error\\\"\\n        *ngIf=\\\"form.get('reference').hasError('required')\\\">\\n        * Please enter the reference\\n      </ion-text>\\n      <!-- for reference error -->\\n      <ion-text\\n        class=\\\"error\\\"\\n        *ngIf=\\\"!form.get('reference').hasError('required')\\n          && form.get('reference')\\\">\\n        * Please enter the payment reference\\n      </ion-text>\\n    </ion-text>\\n  </div>\\n</form>\\n\\n<div class=\\\"ion-margin-horizontal\\\">\\n  <ion-button\\n    *ngIf=\\\"!isLoading\\\"\\n    size=\\\"large\\\"\\n    expand=\\\"block\\\"\\n    shape=\\\"round\\\"\\n    color=\\\"primary\\\"\\n    (click)=\\\"biometricAuth()\\\">\\n    <ion-text>Confirm</ion-text>\\n  </ion-button>\\n  <ion-button\\n    *ngIf=\\\"isLoading\\\"\\n    size=\\\"large\\\"\\n    expand=\\\"block\\\"\\n    shape=\\\"round\\\"\\n    color=\\\"primary\\\">\\n    <ion-spinner></ion-spinner>\\n  </ion-button>\\n</div>\\n\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { UserDetailsPage } from './user-details.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: UserDetailsPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class UserDetailsPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport {FormsModule, ReactiveFormsModule} from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { UserDetailsPageRoutingModule } from './user-details-routing.module';\n\nimport { UserDetailsPage } from './user-details.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    UserDetailsPageRoutingModule,\n    ReactiveFormsModule\n  ],\n  declarations: [UserDetailsPage]\n})\nexport class UserDetailsPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { AuthService } from 'src/app/services/auth/auth.service';\nimport {doc, Firestore, getDoc} from '@angular/fire/firestore';\nimport { IrohaService } from '../../../../services/iroha/iroha.service';\nimport {AlertController, LoadingController, MenuController} from '@ionic/angular';\nimport {AngularFireAuth} from '@angular/fire/compat/auth';\nimport {AvailableResult, BiometryType, Credentials, NativeBiometric} from 'capacitor-native-biometric';\nimport {StorageService} from \"../../../../services/storage/storage.service\";\n\n@Component({\n  selector: 'app-user-details',\n  templateUrl: './user-details.page.html',\n  styleUrls: ['./user-details.page.scss'],\n})\n\nexport class UserDetailsPage implements OnInit {\n\n  form: FormGroup;\n  type = false;\n  isLoading: boolean;\n  loading: any;\n  id = this.ionicAuthService.getUid();\n  private currentUser: any;\n\n  constructor(\n    private authService: AuthService,\n    private router: Router,\n    private _firestore: Firestore,\n    private ionicAuthService: AuthService,\n    private iroha: IrohaService,\n    private loadingController: LoadingController,\n    private afAuth: AngularFireAuth,\n    private alertController: AlertController,\n    private menu: MenuController\n) {\n    this.initForm();\n    this.afAuth.onAuthStateChanged(user => {\n      this.currentUser = user;\n    });\n    this.menu.enable(false);\n  }\n  async ionViewDidLeave() {\n    await this.menu.enable(true);\n    this.iroha.otherWallet.name = '';\n  }\n\n  ngOnInit() {\n\n  }\n\n  initForm() {\n    this.form = new FormGroup({\n      amount: new FormControl(null, {validators: [Validators.required, Validators.pattern('^(\\\\d+(\\\\.\\\\d{0,2})?|\\\\.?\\\\d{1,2})$')]}),\n      reference: new FormControl(null, {validators: [Validators.required]}), // added email validator also\n    });\n  }\n\n  changeType() {\n    this.type = !this.type;\n  }\n\n  biometricAuth() {\n    if(!this.form.valid) {\n      this.form.markAllAsTouched();\n      return;\n    }\n    NativeBiometric.isAvailable().then(\n      async (result: AvailableResult) => {\n        const isAvailable = result.isAvailable;\n        const isFaceId = result.biometryType === BiometryType.FACE_ID;\n\n        if (isAvailable) {\n          // Get user's credentials\n          NativeBiometric.getCredentials({\n            server: 'chainfox',\n          }).then((credentials: Credentials) => {\n            // Authenticate using biometrics before logging the user in\n            NativeBiometric.verifyIdentity({\n              reason: 'For easy log in',\n              title: 'Log in',\n              subtitle: 'Maybe add subtitle here?',\n              description: 'Maybe a description too?',\n            }).then(\n              () => {\n                // Authentication successful\n                this.onSubmit();\n              },\n              (error) => {\n                // Failed to authenticate\n              }\n            );\n          });\n        } else {\n          await this.presentPrompt();\n        }\n      },\n      async (error) => {\n        // Couldn't check availability\n        await this.presentPrompt();\n      }\n    );\n  }\n\n  async onSubmit() {\n\n    const temp = this.iroha.otherWallet.name;\n    this.isLoading = true;\n    // eslint-disable-next-line no-underscore-dangle\n    const docRef = doc(this._firestore, 'users', this.currentUser.uid);\n    const docSnap = await getDoc(docRef);\n    if (docSnap.exists()) {\n      const name = docSnap.data().username.concat('@test');\n      this.iroha.wallet.name = '';\n      await this.iroha.setName(name);\n    }\n    await this.iroha.sendMoney(this.form.value.reference, this.form.value.amount, temp).catch(async e => {\n        this.isLoading = false;\n        await this.showAlert('Transfer Failed', e);\n        await this.router.navigate(['tabs']);\n      }\n    );\n    this.isLoading = false;\n  }\n\n  back() {\n    this.router.navigateByUrl('/tabs/search', {replaceUrl: true});\n  }\n\n  async showAlert(header, message) {\n    const alert = await this.alertController.create({\n      header,\n      message,\n      buttons: ['OK'],\n    });\n    await alert.present();\n  }\n\n  async presentPrompt() {\n    const alert = await this.alertController.create({\n      header: 'User verification',\n      inputs: [\n        {\n          name: 'password',\n          placeholder: 'Password',\n          type: 'password'\n        }\n      ],\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel',\n          handler: data => {\n            console.log('Cancel clicked');\n          }\n        },\n        {\n          text: 'Confirm',\n          handler: async data => {\n            this.loadingController.create({\n              message: 'Verifying...',\n            }).then(async overlay => {\n              this.loading = overlay;\n              this.loading.present();\n              await this.iroha.getAccDetail('sec');\n              if (data.password === this.iroha.pw) {\n                this.loading.dismiss();\n                await this.onSubmit();\n              }\n              else {\n                this.loading.dismiss();\n                await this.showAlert('Verification Failed', 'You entered the wrong password');\n                await this.router.navigate(['tabs']);\n              }\n            });\n          }\n        }\n      ]\n    });\n    await alert.present();\n  }\n}\n\n"],"names":[],"sourceRoot":"webpack:///"}