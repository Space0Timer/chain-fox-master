{"version":3,"file":"src_app_pages_my-cart_my-cart_module_ts.js","mappings":"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","sources":["./src/app/pages/my-cart/my-cart.page.html","./src/app/pages/my-cart/my-cart-routing.module.ts","./src/app/pages/my-cart/my-cart.module.ts","./src/app/pages/my-cart/my-cart.page.ts"],"sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-button color=\\\"primary\\\" (click)=\\\"back()\\\" routerDirection=\\\"forward\\\">\\n        <ion-icon name=\\\"chevron-back-outline\\\"></ion-icon>\\n      </ion-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content fullscreen=\\\"true\\\">\\n  <h1 class=\\\"title\\\">Cart</h1>\\n\\n  <div class=\\\"cart-items\\\">\\n    <ng-container *ngFor=\\\"let cart of cart\\\">\\n      <div>\\n        <app-cart-card [cart]=\\\"cart\\\" (childEvent)=\\\"updateQuantity()\\\"></app-cart-card>\\n      </div>\\n    </ng-container>\\n  </div>\\n\\n</ion-content>\\n<ion-footer translucent=\\\"true\\\" class=\\\"ion-no-border\\\" mode=\\\"md\\\" *ngIf=\\\"cart.length !== 0\\\">\\n  <ion-toolbar color=\\\"translucent\\\">\\n    <ion-button expand=\\\"block\\\" class=\\\"main-button\\\" (click)=\\\"checkOut()\\\" >Checkout</ion-button>\\n  </ion-toolbar>\\n</ion-footer>\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MyCartPage } from './my-cart.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MyCartPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MyCartPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MyCartPageRoutingModule } from './my-cart-routing.module';\n\nimport { MyCartPage } from './my-cart.page';\nimport {SharedModule} from \"../../shared\";\n\n@NgModule({\n    imports: [\n        CommonModule,\n        FormsModule,\n        IonicModule,\n        MyCartPageRoutingModule,\n        SharedModule\n    ],\n  declarations: [MyCartPage]\n})\nexport class MyCartPageModule {}\n","import {Component, Injectable, Input, OnChanges, OnInit, SimpleChanges} from '@angular/core';\nimport {Router} from '@angular/router';\nimport {AuthService} from '../../services/auth/auth.service';\nimport {AngularFirestore, DocumentData} from '@angular/fire/compat/firestore';\nimport {doc, Firestore, getDoc, onSnapshot, query} from '@angular/fire/firestore';\nimport {ICartCard} from '../../shared';\nimport {ProductService} from '../../services/store/product.service';\nimport {AlertController, LoadingController, MenuController} from '@ionic/angular';\n\nexport interface Keys {\n  id: string;\n}\n@Component({\n  selector: 'app-my-cart',\n  templateUrl: './my-cart.page.html',\n  styleUrls: ['./my-cart.page.scss'],\n})\n\n\nexport class MyCartPage implements OnInit{\n\n  cart: ICartCard [] = [\n  ];\n  keys: Keys [] = [];\n  owner: string;\n  loading: any;\n  counter = 0;\n  public total = 0;\n  private id = this.ionicAuthService.getUid();\n  constructor(\n    private router: Router,\n    private ionicAuthService: AuthService,\n    private afs: AngularFirestore,\n    private product: ProductService,\n    private _firestore: Firestore,\n    private loadingController: LoadingController,\n    private alertController: AlertController,\n    private menu: MenuController\n  ) {\n    this.menu.enable(false);\n  }\n  async ionViewDidLeave() {\n    await this.menu.enable(true);\n  }\n\n  async ngOnInit() {\n  }\n  async ionViewWillEnter() {\n    this.keys = [];\n    this.cart = [];\n    await this.addItemsToCart();\n  }\n\n  async addItemsToCart() {\n      let data: DocumentData;\n      this.total = 0;\n      // eslint-disable-next-line no-underscore-dangle\n      const itemIdRef = doc(this._firestore, `carts/${(this.id)}`);\n      await getDoc(itemIdRef)\n        .then(snap => {\n          data = snap.data();\n          delete data.lastUpdate;\n          delete data.id;\n        });\n      for (const key in data) {\n        // get owner id from item id\n        this.keys.push({id: key});\n        const idOwnerRef = doc(this._firestore, `idOwner/${(key.split('@')[0])}`);\n        const idOwnerSnap = await getDoc(idOwnerRef);\n        const idOwnerName = idOwnerSnap.data();\n        this.owner = idOwnerName.owner;\n        const ownerRef = doc(this._firestore, `stores/${(this.owner)}`);\n        const ownerSnap = await getDoc(ownerRef);\n        const ownerName = ownerSnap.data();\n        // eslint-disable-next-line no-underscore-dangle\n        const dataRef = doc(this._firestore, `stores/${(this.owner)}/items/${(key.split('@')[0])}`);\n        const docSnap = await getDoc(dataRef);\n        const dataSnap = docSnap.data();\n        const value = data[key];\n        console.log(key);\n        const keys = key.split('@')[1].split('-').slice(0, -1);\n        let optionSnap = 0;\n        for (const price of keys) {\n          console.log(price);\n          // eslint-disable-next-line max-len\n          const optionRef = doc(this._firestore, `stores/${(this.owner)}/items/${(key.split('@')[0])}/optionPrice/${(price)}`);\n          const optSnap = await getDoc(optionRef);\n          optionSnap += Number(optSnap.data().price);\n        }\n        this.cart.push(\n          {\n            name: dataSnap.name,\n            owner: ownerName.name,\n            price: Number(dataSnap.price) + optionSnap,\n            image: dataSnap.imageUrl,\n            id: key,\n            ownerId: this.owner,\n            message: '',\n            deliveryTime: '',\n            quantity: value,\n          },\n        );\n        this.total += Number(dataSnap.price) + optionSnap;\n      }\n    }\n\n\n  updateQuantity() {\n    this.cart = [];\n    this.addItemsToCart();\n  }\n\n  // check for illegal time (out business hours) pickup time\n  async checkOut() {\n    for (const key in this.keys) {\n      const illegalTime = ['00', '01', '01', '02', '03', '04', '05', '06', '07', '22', '23'];\n      if (this.product.orderTimePair.get(this.keys[key].id) === undefined) {\n        await this.showAlert('Please choose a valid pickup date for your orders.' + this.keys[key].id );\n        this.counter = 1;\n        break;\n      }\n      else if(illegalTime.includes(this.product.orderTimePair.get(this.keys[key].id.substring(11, 13)))) {\n        await this.showAlert('Please choose a valid pickup date for your orders.' +  this.product.orderTimePair.get(this.keys[key].id.substring(11, 13)) );\n        this.counter = 1;\n        break;\n      }\n    }\n    if (this.counter === 0) {\n      await this.router.navigate(['checkout']);\n    }\n    this.counter = 0;\n  }\n\n  back() {\n    this.router.navigateByUrl('tabs/account', {replaceUrl: true});\n  }\n\n  async showAlert(message) {\n    const alert = await this.alertController.create({\n      header: 'Invalid pickup date',\n      message,\n      buttons: ['OK'],\n    });\n\n    await alert.present();\n  }\n}\n"],"names":[],"sourceRoot":"webpack:///"}