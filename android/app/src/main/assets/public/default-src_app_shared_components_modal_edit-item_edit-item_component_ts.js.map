{"version":3,"file":"default-src_app_shared_components_modal_edit-item_edit-item_component_ts.js","mappings":"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","sources":["./src/app/shared/components/modal/edit-item/edit-item.component.html","./src/app/shared/components/modal/edit-item/edit-item.component.ts"],"sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-button color=\\\"primary\\\" (click)=\\\"back()\\\" routerDirection=\\\"forward\\\">\\n        <ion-text>Cancel</ion-text>\\n      </ion-button>\\n    </ion-buttons>\\n    <ion-buttons slot=\\\"end\\\">\\n    <ion-button\\n      *ngIf=\\\"!isLoading\\\"\\n      color=\\\"primary\\\"\\n      (click)=\\\"onSubmit()\\\">\\n      <ion-text style=\\\"font-weight: bold\\\">Confirm</ion-text>\\n    </ion-button>\\n    <ion-button\\n      *ngIf=\\\"isLoading\\\"\\n      >\\n      <ion-spinner color=\\\"primary\\\"></ion-spinner>\\n    </ion-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n<ion-content fullscreen=\\\"true\\\">\\n  <div class ='ion-padding'>\\n  <ion-row style=\\\"padding-left: 0\\\">\\n    <ion-col size=\\\"10\\\">\\n      <ion-text  color=\\\"primary\\\" style=\\\"font-size: 26px; font-weight: bold\\\">Your Item</ion-text>\\n    </ion-col>\\n  </ion-row>\\n  <div class=\\\"ion-margin-horizontal\\\">\\n    <form [formGroup]=\\\"form\\\" class=\\\"ion-margin\\\">\\n      <div class=\\\"ion-margin-vertical\\\">\\n        <ion-item lines=\\\"full\\\">\\n          <ion-input formControlName=\\\"name\\\" [type]=\\\"type ? 'text' : 'text'\\\" placeholder=\\\"Enter item name\\\" ngModel=\\\"{{this.product.editItemName}}\\\"></ion-input>\\n        </ion-item>\\n        <ion-text\\n          color=\\\"danger\\\"\\n          *ngIf=\\\"!form.get('name').valid && form.get('name').touched\\\">\\n          <ion-text\\n            class=\\\"error\\\"\\n            *ngIf=\\\"form.get('name').hasError('required')\\\">\\n            * Please enter the store name\\n          </ion-text>\\n        </ion-text>\\n      </div>\\n      <div class=\\\"ion-margin-vertical\\\">\\n        <ion-item lines=\\\"full\\\">\\n          <ion-input formControlName=\\\"price\\\" [type]=\\\"type ? 'number' : 'number'\\\" ngModel=\\\"{{this.product.editItemPrice}}\\\" placeholder=\\\"Enter price\\\"></ion-input>\\n        </ion-item>\\n        <ion-text\\n          color=\\\"danger\\\"\\n          *ngIf=\\\"!form.get('price').valid && form.get('price').touched\\\">\\n          <ion-text\\n            class=\\\"error\\\"\\n            *ngIf=\\\"form.get('price').hasError('required')\\\">\\n            * Please enter the price\\n          </ion-text>\\n        </ion-text>\\n      </div>\\n        <div class=\\\"ion-margin-vertical\\\">\\n          <ion-item lines=\\\"full\\\">\\n            <ion-input formControlName=\\\"description\\\" [type]=\\\"type ? 'text' : 'text'\\\" ngModel=\\\"{{this.product.editItemDescription}}\\\" placeholder=\\\"Enter description\\\"></ion-input>\\n          </ion-item>\\n          <ion-text\\n            color=\\\"danger\\\"\\n            *ngIf=\\\"!form.get('description').valid && form.get('description').touched\\\">\\n            <ion-text\\n              class=\\\"error\\\"\\n              *ngIf=\\\"form.get('description').hasError('required')\\\">\\n              * Please enter the description\\n            </ion-text>\\n          </ion-text>\\n        </div>\\n    </form>\\n    <ion-card mode=\\\"ios\\\" class=\\\"ion-padding\\\">\\n      <ion-row>\\n        <ion-col size=\\\"10\\\">\\n          <ion-card-title style=\\\"font-size: 18px; padding-top: 3px\\\" >Order customisation</ion-card-title>\\n        </ion-col>\\n        <ion-col size=\\\"2\\\" class=\\\"ion-text-right\\\">\\n          <ion-buttons>\\n            <ion-button  (click)=\\\"openCustomiseOrderModal('')\\\">\\n              <ion-icon name=\\\"add-circle-outline\\\"></ion-icon>\\n            </ion-button>\\n          </ion-buttons>\\n        </ion-col>\\n      </ion-row>\\n    </ion-card>\\n    <ion-row style=\\\"padding-left: 0\\\">\\n      <ion-col size=\\\"10\\\">\\n        <ion-text  color=\\\"primary\\\" style=\\\"font-size: 26px; font-weight: bold\\\">Current Customisation</ion-text>\\n      </ion-col>\\n    </ion-row>\\n    <ion-item *ngFor=\\\"let customOption of this.product.customOptions\\\">\\n      <ion-card mode=\\\"ios\\\" class=\\\"ion-padding\\\">\\n        <ion-row>\\n          <ion-col>\\n            <ion-card-title style=\\\"font-size: 18px; padding-top: 3px\\\" >{{customOption.name}}</ion-card-title>\\n          </ion-col>\\n          <ion-col class=\\\"ion-text-right\\\">\\n            <ion-buttons>\\n              <ion-button (click)=\\\"openCustomiseOrderModal(customOption.name)\\\">\\n                <ion-icon name=\\\"pencil-outline\\\"></ion-icon>\\n              </ion-button>\\n              <ion-button (click)=\\\"deleteCustomisation(customOption.name)\\\">\\n                <ion-icon name=\\\"trash-outline\\\"></ion-icon>\\n              </ion-button>\\n            </ion-buttons>\\n          </ion-col>\\n        </ion-row>\\n      </ion-card>\\n    </ion-item>\\n      </div>\\n  </div>\\n</ion-content>\\n\";","import {Component, OnChanges, OnDestroy, OnInit} from '@angular/core';\nimport firebase from 'firebase/compat/app';\nimport {AuthService} from '../../../../services/auth/auth.service';\nimport {AngularFirestore} from '@angular/fire/compat/firestore';\nimport {FirebaseUploadService} from '../../../../services/cafe/firebase-upload.service';\nimport {Router} from '@angular/router';\nimport {collection, doc, Firestore, getDoc, getDocs, query, setDoc} from '@angular/fire/firestore';\nimport {ProductService} from '../../../../services/cafe/product.service';\nimport {FormControl, FormGroup, Validators} from '@angular/forms';\nimport {AlertController, ModalController} from '@ionic/angular';\nimport {CustomiseOrderPage} from '../customise-order/customise-order.page';\n\n@Component({\n  selector: 'app-edit-item',\n  templateUrl: './edit-item.component.html',\n  styleUrls: ['./edit-item.component.scss'],\n})\nexport class EditItemComponent{\n  barStatus = false;\n  errorMessage = '';\n  imageUploads = [];\n  name = '';\n  form: FormGroup;\n  type = false;\n  isLoading: boolean;\n  imageUrl = '';\n  object = Object;\n  private uid = this.ionicAuthService.getUid();\n\n  constructor(private firebaseUploadService: FirebaseUploadService,\n              private router: Router,\n              private _firestore: Firestore,\n              private ionicAuthService: AuthService,\n              private afs: AngularFirestore,\n              private product: ProductService,\n              private modalController: ModalController,\n              private alertController: AlertController) {\n    this.initForm();\n  }\n\n  async ionViewWillEnter() {\n    await this.getOptionFromFirebase();\n  }\n\n  async showAlert(header,message) {\n    const alert = await this.alertController.create({\n      header,\n      message,\n      buttons: ['OK'],\n    });\n\n    await alert.present();\n  }\n\n  initForm() {\n    this.form = new FormGroup({\n      name: new FormControl(null, {validators: [Validators.required]}),\n      price: new FormControl(null, {validators: [Validators.required]}),\n      description: new FormControl(null, {validators: [Validators.required]}),\n    });\n  }\n\n  async getOptionFromFirebase() {\n    this.product.customOptions = [];\n    this.product.customOption = [];\n    const dataRef = collection(this._firestore, 'stores/' + this.uid + '/items/' + this.product.editItemId +'/options');\n    const q = query(dataRef);\n    const querySnapshot = await getDocs(q);\n    querySnapshot.forEach((docu) => {\n      const data = docu.data();\n      console.log(data);\n      this.product.customOption = data;\n      // delete duplicates\n      if (this.product.customOptions.length === 0) {\n        this.product.customOptions.push({\n          name: this.product.customOption.name,\n          data: this.product.customOption,\n          checked: false\n        });\n      }\n      else {\n        for (const key in this.product.customOptions) {\n          if (this.product.customOptions[key].name !== this.product.customOption.name) {\n            this.product.customOptions.push({\n              name: this.product.customOption.name,\n              data: this.product.customOption,\n              checked: false\n            });\n          }\n          else {\n            this.product.customOptions[key].data = this.product.customOption;\n          }\n        }\n      }\n    });\n  }\n\n  changeType() {\n    this.type = !this.type;\n  }\n\n  async deleteCustomisation(id) {\n    await this.afs.collection(`stores/${(this.uid)}/items/${(this.product.editItemId)}/options`).doc(id).delete();\n    await this.ionViewWillEnter();\n  }\n  async back() {\n    await this.modalController.dismiss();\n  }\n\n\n  async onSubmit() {\n    console.log(this.form.value);\n    this.errorMessage = '';\n    if(!this.form.valid) {\n      this.form.markAllAsTouched();\n      return;\n    }\n    this.isLoading = true;\n    await this.edit(this.product.editItemId);\n    await this.showAlert('Editing Item', 'Item successfully edited.');\n    this.isLoading = false;\n    await this.modalController.dismiss();\n  }\n\n  async edit(id) {\n    await this.afs.collection(`stores/${(this.uid)}/items`).doc(id.split('@')[0]).update({\n      name: this.form.value.name,\n      price: this.form.value.price,\n      description: this.form.value.description,\n      lastUpdate: firebase.firestore.FieldValue.serverTimestamp()\n    });\n  }\n\n  async openCustomiseOrderModal(nameInput) {\n    const name = nameInput;\n    for (const key in  this.product.customOptions) {\n      if (this.product.customOptions[key].name === name) {\n        this.product.customOption = this.product.customOptions[key].data;\n        console.log(this.product.customOption);\n        this.product.customNew = false;\n      }\n    }\n    const modal = await this.modalController.create({\n      component: CustomiseOrderPage,\n      swipeToClose: true,\n      presentingElement: await this.modalController.getTop()\n    });\n    await modal.present();\n    await modal.onDidDismiss().then(r=> {\n      this.ionViewWillEnter();\n    });\n  }\n}\n"],"names":[],"sourceRoot":"webpack:///"}